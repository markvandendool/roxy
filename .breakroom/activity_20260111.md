# Agent Breakroom Activity Log

**Date:** 2026-01-11
**Agent:** Claude Opus 4.5 (ROXY-side)
**Session:** Theater Recording Integration - ROXY Infrastructure

---

## Session Summary

### Mission
Integrate MindSong 8K Theater with ROXY OBS control for automated theater recording.
**Scope:** ROXY-side only. MindSong agent handles browser-side wiring.

---

## ROXY-SIDE WORK COMPLETED

### 1. Gate B/C/D Verified (selftest scripts)
- `selftest_obs_ws_real.py` - OBS WebSocket connection PASS
- `selftest_gate_c_preset_scene.py` - Preset→Scene mapping PASS (2/2)
- `selftest_gate_d_recording.py` - Recording mode PASS (5/5)

**Proof:** `services/sha256_manifest.txt` with checksums

### 2. OBS Director Service Created
- `services/obs_director.py` - Orchestrates OBS for theater recordings
- `services/theater_session.py` - Session manifest handling
- `config/theater_obs_mapping.json` - Preset→Scene mappings

**NATS Topics:**
- `ghost.theater.status`
- `ghost.theater.recording.start`
- `ghost.theater.recording.stop`
- `ghost.theater.session.complete`

### 3. Governance Applied
- EPIC-THEATER-RECORDING added to MindSong's master-progress.json
- 12 stories, 9 done, 1 todo, 2 blocked
- Commit: `9b0eb5ee2e` on mindsong-juke-hub

---

## INTERFACE CONTRACT FOR MINDSONG AGENT

### Hub Location
```
tools/theater-control-hub/src/hub.ts
Endpoint: ws://127.0.0.1:9137/theater-control?role={stage|director|observer}
```

### Commands ROXY Will Send (Director Role)
| Command | Payload | Expected Behavior |
|---------|---------|-------------------|
| `load_song` | `{ path: string }` | Load song into SongVaultLoader, prepare transport |
| `set_widget_visibility` | `{ widgetId: string, visible: boolean }` | Call TheaterWidgetManager.setWidgetVisibility() |
| `play` | `{}` | Call transportControllerStore.play() |
| `pause` | `{}` | Call transportControllerStore.pause() |
| `stop` | `{}` | Call transportControllerStore.stop() |
| `seek` | `{ tick: number }` | Seek transport to tick |
| `set_preset` | `{ preset: string }` | Switch theater preset |
| `start_ndi` | `{ quality: string }` | Start NDI streaming |
| `stop_ndi` | `{}` | Stop NDI streaming |

### Events ROXY Will Listen For (From Stage)
| Event | Payload | ROXY Action |
|-------|---------|-------------|
| `tick` | `{ tick, seconds }` | Sync recording timecode |
| `playback_changed` | `{ state }` | Track transport state |
| `song_ended` | `{}` | Trigger post-roll + stop recording |
| `ndi_started` | `{ streams[] }` | Confirm NDI sources available |
| `section_changed` | `{ section, tick }` | Scene switching (if enabled) |

### Files MindSong Agent Must Wire

#### TheaterControlStageClient.ts
Current state: `onCommand()` exists at line 430, but NO handlers registered.

**Needed:**
```typescript
// In TheaterControlStageClient.ts
client.onCommand('load_song', async (payload) => {
  // Wire to SongVaultLoader
});

client.onCommand('set_widget_visibility', async (payload) => {
  // Wire to TheaterWidgetManager.setWidgetVisibility(payload.widgetId, payload.visible)
});

client.onCommand('play', async () => {
  // Wire to transportControllerStore.getState().play()
});

// ... etc for pause, stop, seek
```

#### Hub Startup
Hub must be running for communication. Options:
1. Add to `start-universe.sh`: `cd tools/theater-control-hub && bun run hub.ts &`
2. Create systemd service

---

## BLOCKERS (Waiting on MindSong Agent)

| # | Blocker | MindSong File | What's Needed |
|---|---------|---------------|---------------|
| 1 | Hub not running | `tools/theater-control-hub/` | Add startup script |
| 2 | No `load_song` handler | `TheaterControlStageClient.ts` | Wire to SongVaultLoader |
| 3 | No `set_widget_visibility` handler | `TheaterControlStageClient.ts` | Wire to TheaterWidgetManager |
| 4 | No transport handlers | `TheaterControlStageClient.ts` | Wire play/pause/stop/seek |
| 5 | DrumKit not a widget | `EightKTheaterStage.tsx` | Wrap in widget OR add visibility API |

---

## Q&A ANSWERS (For Cross-Agent Reference)

| Q | Answer | File Path |
|---|--------|-----------|
| Q1: Widget visibility source of truth | `TheaterWidgetManager.setWidgetVisibility()` | `src/components/theater8k/TheaterWidgetManager.ts:189` |
| Q2: Canonical song loading | SongVaultLoader (data) + transportControllerStore (playback) | `src/services/songvault/SongVaultLoader.ts` |
| Q3: DrumKit | NOT a widget - Three.js overlay | `src/components/theater8k/EightKTheaterStage.tsx:818-941` |
| Q4: Metronome integration | TimelineContext subscription | `src/components/theater8k/widgets/metronome/ToussaintMetronomeWidget.tsx` |
| Q5: TRAX status | Placeholder widget awaiting WebGPU impl | `src/components/theater8k/widgets/trax/TraxWidget.tsx` |
| Q6: EventSpine via commands | NO - handlers not wired | `transportControllerStore.ts:316-330` has methods |
| Q7: Hub startup | Manual only | `tools/theater-control-hub/src/hub.ts` |

---

## ROXY READY STATE

| Component | Status | Notes |
|-----------|--------|-------|
| OBS WebSocket | READY | Port 4455, no auth |
| OBS Director | READY | Awaiting hub connection |
| Scene Mappings | READY | 5 presets configured |
| Recording Mode | READY | Tested with 3s recording |
| SKYBEAM Handoff | READY | Path: `~/.roxy/content-pipeline/input/` |
| NATS Topics | READY | ghost.theater.* |

**ROXY is waiting for MindSong hub + handlers.**

---

## Next Steps (ROXY-side)

1. Test OBS Director connection when hub comes online
2. Implement reconnection logic for hub disconnects
3. Add session manifest validation
4. Create CLI for manual session testing

---

## Proof Artifacts

| Artifact | Location |
|----------|----------|
| SHA256 Manifest | `services/sha256_manifest.txt` |
| Gate D Transcript | `services/gate_d_transcript.json` |
| Theater OBS Mapping | `config/theater_obs_mapping.json` |
| Plan File | MindSong: `docs/skoreq/THEATER-RECORDING-INTEGRATION/` |

---

*Session continues: 2026-01-11 14:00 MST*
*Cross-agent communication via: ~/.roxy/.breakroom/ ↔ ~/mindsong-juke-hub/.breakroom/*
